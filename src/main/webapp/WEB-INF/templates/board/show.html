<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Who's DucKing</title>
    <!-- Swiper -->
    <link rel="stylesheet" href="/vendor/swiper/swiper-bundle.min.css">
    <!-- AOS -->
    <link rel="stylesheet" href="/vendor/aos/aos.css">
    <!-- Animate -->
    <link rel="stylesheet" href="/vendor/animate/animate.min.css">
    <!-- CSS -->
    <link rel="stylesheet" href="/css/Common.css" />

    <!-- jQuery -->
    <script src="/vendor/jquery/jquery-3.7.1.min.js"></script>
    <!-- swiper -->
    <script src="/vendor/swiper/swiper-bundle.min.js"></script>
    <!-- AOS -->
    <script src="/vendor/aos/aos.js"></script>
    <!-- FontAwesome -->
    <script src="https://kit.fontawesome.com/2f3ee9d12e.js" crossorigin="anonymous"></script>
    <!-- JavaScript -->
    <script type="text/javascript" src="/js/common.js"></script>

</head>
<body>
<div th:insert="~{fragments/header :: header}"></div>
<div class="board-container-title-wrapper">
    <div class="board-container-title">자유 게시판</div>
    <a href="/board" class="btn-secondary"> <i class="fa-solid fa-bars"></i>목록</a>
</div>

<hr class="comment-section-orange-line">
<div class="board-title-line" style="position: relative;">
    <span class="board-author" th:text="${board.user.nickname}">작성자</span>
    <span class="board-title" th:text="${board.title != null && !board.title.isEmpty() ? board.title : '제목없음'}">제목</span>
    <span class="board-menu-toggle" id="board-menu-toggle"><i class="fa-solid fa-ellipsis-vertical"></i></span>
</div>

<div id="board-menu" class="board-menu-content">
    <a th:href="@{/board/{boardId}/edit(boardId=${board.id})}" class="menu-item">수정</a>
    <form th:action="@{/board/{boardId}/delete(boardId=${board.id})}" method="post" style="display: inline;">
        <button type="submit" class="menu-item">삭제</button>
    </form>
    <a href="#" class="menu-item">신고</a>
</div>
<div class="board-container">
    <div class="board-boomark-box">
        <i id="board-bookmark-button" class="${isBookmarked ? 'fa-solid' : 'fa-regular'} fa-bookmark bookmark-icon" th:attr="data-board-id=${board.id}"></i>
    </div>

    <div class="form-group" th:if="${board.imageName != null}">
        <img class="board-img" id="boardImagePreview"
             th:src="@{'/image/board/' + ${board.imageName}}"
             alt="Board Image"/>
    </div>
    <hr class="show-hr-line">
    <div class="board-content">
        <p th:text="${board.content}">내용</p>
    </div>
    <hr class="show-hr-line">
    <div class="board-meta">
        <span class="board-date" th:text="${#temporals.format(board.writeDate, 'yyyy-MM-dd HH:mm')}">작성일</span>
    </div>
</div>

<section class="comment-section">
    <hr class="comment-section-orange-line">
    <div class="comment-count-box">
        <img class="comment-count-icon" src="/images/comment_count.svg"/>
        <span class="comment-count" th:text="${comments.size()}">0</span>
    </div>

    <div class="comment-container">
        <form action="#" th:action="@{/board/{boardId}/comment(boardId=${board.id})}" method="post" class="comment-box">
            <span class="board-author" th:text="${board.user.nickname}">작성자</span>
            <textarea class="comment-input" id="comment-input" name="contentWrite" placeholder="문제의 소지가 있을 댓글은 경고 조치 없이 삭제되며 징계 대상이 될 수 있습니다." maxlength="500"></textarea>
            <div class="comment-input-footer">
                <span id="char-counter" class="char-counter">0 / 500</span>
                <button class="comment-submit" type="submit">등록</button>

            </div>
        </form>

        <ul class="comment-list">
            <li class="comment-item" th:each="comment : ${comments}">
                <div class="comment-content">
                    <span class="comment-writer" th:text="${comment.user.nickname}"></span>
                    <span class="board-menu-toggle"><i class="fa-solid fa-ellipsis-vertical" onclick="toggleCommentMenu(this)"></i></span>
                </div>
                <span class="comment-writer-result" th:text="${comment.content}"></span><br>
                <span class="comment-date" th:text="${#temporals.format(comment.writeDate, 'yyyy.MM.dd HH:mm')}"></span>
                <div class="comment-meta" th:data-comment-id="${comment.id}">
                    <button class="comment-likes" onclick="toggleLike(this)">
                        <i class="fa-regular fa-thumbs-up"></i>
                    </button>
                    <button class="comment-dislikes" onclick="toggleDislike(this)">
                        <i class="fa-regular fa-thumbs-down"></i>
                    </button>
                </div>
                <div class="comment-menu">
                    <div class="comment-menu-header">
                        <i class="fa-solid fa-xmark" onclick="toggleCommentMenu(this)"></i>
                    </div>
                    <form action="#" th:action="@{/board/{boardId}/comment/{commentId}/edit(boardId=${board.id}, commentId=${comment.id})}" method="post" class="comment-edit-form">
                        <button type="submit" class="menu-item">수정</button>
                        <input type="text" class="edit-board-content" name="contentUpdate" placeholder="수정할 댓글 내용" />

                    </form>
                    <form action="#" th:action="@{/board/{boardId}/comment/{commentId}/delete(boardId=${board.id}, commentId=${comment.id})}" method="post">
                        <button type="submit" class="menu-item">삭제</button>
                    </form>

                </div>
            </li>
        </ul>
    </div>
</section>
<div th:insert="~{fragments/footer :: footer}"></div>

<script>
    // 메뉴 기능
   document.addEventListener('DOMContentLoaded', (event) => {
       const menuToggle = document.getElementById('board-menu-toggle');
       const menu = document.getElementById('board-menu');
       const commentInput = document.getElementById('comment-input');
       const charCounter = document.getElementById('char-counter');

       if (menuToggle && menu) {
           menuToggle.addEventListener('click', function(e) {
               e.stopPropagation();
               const rect = menuToggle.getBoundingClientRect();
               menu.style.top = `${rect.bottom + window.scrollY}px`;
               menu.style.left = `${rect.right + window.scrollX - menu.offsetWidth}px`;
               menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
           });

           document.addEventListener('click', function(e) {
               if (!menu.contains(e.target) && e.target !== menuToggle) {
                   menu.style.display = 'none';
               }
           });
       }
        // 0/500 내용 카운트
       if (commentInput && charCounter) {
           commentInput.addEventListener('input', function() {
               const maxLength = commentInput.getAttribute('maxlength');
               const currentLength = commentInput.value.length;
               charCounter.textContent = `${currentLength} / ${maxLength}`;
           });
       }

       loadLikesDislikes();
   });
</script>
<script type="text/javascript" src="/js/showPage.js"></script>
</body>
</html>
